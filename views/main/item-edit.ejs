<%
user = typeof user !== "undefined" ? user :  {};
item = typeof item !== "undefined" ? item : {};
%>
<script>
    $(document).ready(function(){

        function previewProfileImage( uploader ) {
            console.log('Uploader ----> ',uploader);
            console.log('Uploader ----> ',uploader.files);
            //ensure a file was selected
            if( uploader.files && uploader.files[0] ){
                $('#itemImage2').attr('src', window.URL.createObjectURL(uploader.files[0]) );
            }
        }

        // jQuery methods go here...
        $("#itemImageBtn").click(function(e) {
            $("#imageUpload").click();
        });

        $("#imageUpload").change(function(){
            previewProfileImage( this );
        });
    });
</script>

<div id="mySidebar" class="sidebar">
    <a href="#">Sport courts</a>
    <a href="#">Vehicles</a>
    <a href="#">Items</a>
    <a href="#">Services</a>
</div>

<div id="main">
    <form action="/explore/edit/<%= item._id %>" enctype="multipart/form-data"  method="POST">
    <div class="top-bar">
        <div class="row h-100 align-items-end">
            <div class="col">
                <h5 id="heading-explore">Edit item - <%= item.title %></h5>
            </div>
            <div class="col text-right mb-2">
                <a href="/explore" class="btn btn-outline-danger btn-sm">Cancel</a>
                <button type="submit" class="btn btn-primary btn-sm">
                    Save
                </button>
            </div>
        </div>
    </div>
    <hr style="margin: 0px 20px;">
    <div class="content mt-2">
            <div class="row px-2">
                <div class="col">
                    <%- include('../partials/messages'); %>
                </div>
            </div>
            <!--        <input type="hidden" name="_method" value="PUT">-->
            <div class="row px-2">
                <div class="col-content">
                    <div style="position: relative;">
                        <img id="itemImage2" src="/uploads/<%= item.image || '' %>" alt="item image" width="200px" style="position: relative;">
                        <div class="change-pic-button cursor-pointer">
                            <span id="itemImageBtn">Change image</span>
                            <input id="imageUpload" name="itemPicture" type="file" style="display: none;">
                            <input type="hidden" name="old_image" value="<%= item.image %>">
                        </div>
                    </div>
                </div>

                <div class="col">

                    <!-- Title, short desc, category -->
                    <div class="row">
                        <div class="col-12">
                            <div class="form-group">
                                <label for="title">Title</label>
                                <input
                                        type="text"
                                        id="title"
                                        name="title"
                                        class="form-control"
                                        placeholder="Enter Title"
                                        value="<%=  item.title || '' %>"
                                />
                            </div>
                        </div>
                        <div class="col-12">
                            <div class="form-group">
                                <label for="shortDesc">Short description</label>
                                <input
                                        type="text"
                                        id="shortDesc"
                                        name="shortDesc"
                                        class="form-control"
                                        placeholder="Enter short description"
                                        value="<%= item.shortDesc || '' %>"
                                >
                            </div>
                        </div>
                        <div class="col-12">
                            <div class="form-group">
                                <label for="category">Category</label>
                                <select class="custom-select form-control" id="category" name="category" value="<%= item.category || 'Sport courts' %>">
                                    <%
                                        const allOptionsCategory = {
                                            'sport-court': "Sport courts",
                                            'vehicle': "Vehicles",
                                            'service': "Services",
                                            'other': "Other"
                                        }

                                        const renderOptionsCategory = Object.keys(allOptionsCategory).map(x => {
                                            if(x === item.category){
                                                return `<option selected value="${x}">${allOptionsCategory[x]}</option>`;
                                            } else {
                                                return `<option value="${x}">${allOptionsCategory[x]}</option>`;
                                            }
                                        });

                                        for(let i = 0; i < renderOptionsCategory.length; i++){
                                    %>
                                        <%- renderOptionsCategory[i] %>
                                    <% } %>
                                </select>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <hr class="m-0 px-2">

            <div class="row px-2">
                <div class="col p-0">
                    <!-- Long desc -->
                    <div class="row">
                        <div class="col-12">
                            <div class="form-group">
                                <label for="longDesc">Description</label>
                                <textarea
                                        type="text"
                                        id="longDesc"
                                        name="longDesc"
                                        class="form-control"
                                        placeholder="Enter description"
                                        rows="7"
                                ><%= item.longDesc || '' %></textarea>
                            </div>
                        </div>

                    </div>

                    <!-- Prices -->
                    <div class="row">
                        <div class="col-12 col-md-6">
                            <div class="form-group">
                                <label for="price">Price (â‚¬)</label>
                                <input
                                        type="number"
                                        id="price"
                                        name="price"
                                        class="form-control"
                                        placeholder="Enter price"
                                        value="<%= item.price || 'h' %>"
                                        min="0"
                                />
                            </div>
                        </div>
                    </div>
                    <!-- Address-->
                    <div class="row">
                        <div class="col-12">
                            <div class="form-group">
                                <label for="address">Address</label>
                                <input
                                        type="text"
                                        id="address"
                                        name="address"
                                        class="form-control"
                                        placeholder="Enter address"
                                        value="<%= item.address || '' %>"
                                />
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </form>
</div>